<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>DIAG4U+ ‚Äì Priorit√©s & Mini-parcours Life Skills</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Police simple, tu pourras swap avec la charte MLPB -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #f6f7fb 0%, #ffffff 40%, #f8fbff 100%);
      color: #1a1a1a;
    }
    header {
      padding: 24px 20px 16px;
      border-bottom: 1px solid #e4e7ec;
      background: #ffffffaa;
      backdrop-filter: blur(6px);
      position: sticky;
      top: 0;
      z-index: 20;
    }
    .header-inner {
      max-width: 1120px;
      margin: 0 auto;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
    }
    .title {
      font-size: 1.4rem;
      font-weight: 700;
      letter-spacing: 0.02em;
    }
    .subtitle {
      font-size: 0.9rem;
      color: #667085;
    }
    .step-flow {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      font-size: 0.8rem;
      color: #475467;
    }
    .chip {
      border-radius: 999px;
      padding: 4px 10px;
      background: #f2f4f7;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
    }
    .chip span.icon {
      font-size: 1rem;
    }
    .chip-primary {
      background: #e6f1ff;
      color: #1849a9;
    }

    main {
      max-width: 1120px;
      margin: 16px auto 40px;
      padding: 0 16px 40px;
    }

    section {
      margin-top: 24px;
    }

    h2.section-title {
      font-size: 1.25rem;
      font-weight: 700;
      margin: 0 0 4px;
      display: flex;
      gap: 8px;
      align-items: center;
    }
    h2.section-title span.icon {
      font-size: 1.4rem;
    }
    p.section-desc {
      margin: 0 0 16px;
      font-size: 0.9rem;
      color: #667085;
    }

    .card {
      background: #ffffff;
      border-radius: 16px;
      border: 1px solid #e4e7ec;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.05);
      padding: 16px 18px;
      margin-bottom: 16px;
    }

    /* R√©sultats radar simplifi√©s */
    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
    }
    .domain-pill {
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px solid #e4e7ec;
      background: #f9fafb;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .domain-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.85rem;
    }
    .domain-name {
      font-weight: 600;
      color: #101828;
    }
    .domain-score {
      font-size: 0.8rem;
      color: #475467;
    }
    .score-bar {
      position: relative;
      height: 8px;
      border-radius: 999px;
      background: #e4e7ec;
      overflow: hidden;
    }
    .score-bar-fill {
      position: absolute;
      inset: 0;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #f97316, #e11d48);
      transition: width 0.4s ease;
    }
    .score-tag {
      font-size: 0.7rem;
      align-self: flex-start;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid #eaecf0;
      color: #667085;
      background: #f9fafb;
    }

    /* S√©lection priorit√©s */
    .priority-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 12px;
    }
    .priority-card {
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      padding: 10px 12px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 6px;
      transition: all 0.2s ease;
      position: relative;
    }
    .priority-card.low {
      border-color: #fecaca;
      background: #fef2f2;
    }
    .priority-card.selected {
      border-color: #f97316;
      background: #fff7ed;
      box-shadow: 0 0 0 2px #fed7aa;
    }
    .priority-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: #111827;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .priority-score {
      font-size: 0.8rem;
      color: #6b7280;
    }
    .priority-hint {
      font-size: 0.7rem;
      color: #9ca3af;
    }
    .selection-badge {
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: #f97316;
      color: #fff;
      display: none;
    }
    .priority-card.selected .selection-badge {
      display: inline-flex;
    }

    .counter-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      font-size: 0.8rem;
      color: #667085;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    .btn-primary {
      background: linear-gradient(90deg, #f97316, #e11d48);
      color: #ffffff;
      box-shadow: 0 10px 25px rgba(248, 113, 113, 0.4);
    }
    .btn-secondary {
      background: #f3f4f6;
      color: #111827;
    }
    .btn-small {
      padding: 6px 12px;
      font-size: 0.8rem;
    }
    .btn-primary:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      box-shadow: none;
    }

    /* Mini-parcours */
    .minip-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 14px;
    }
    .minip-card {
      border-radius: 16px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      padding: 12px 14px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .minip-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }
    .minip-title {
      font-size: 0.95rem;
      font-weight: 600;
    }
    .minip-chip {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: #eff6ff;
      color: #1d4ed8;
    }
    .minip-body {
      font-size: 0.8rem;
      color: #4b5563;
    }
    .minip-tools {
      margin: 4px 0 6px;
      font-size: 0.78rem;
      color: #6b7280;
    }

    /* Plan d'action */
    .plan-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
    }
    .plan-block {
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .plan-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      color: #9ca3af;
      letter-spacing: 0.05em;
      font-weight: 600;
    }
    textarea {
      width: 100%;
      min-height: 80px;
      border-radius: 8px;
      border: 1px solid #d0d5dd;
      padding: 6px 8px;
      font-family: inherit;
      font-size: 0.84rem;
      resize: vertical;
    }
    textarea:focus {
      outline: none;
      border-color: #f97316;
      box-shadow: 0 0 0 1px #fed7aa;
      background: #fff;
    }

    /* Zone export */
    .meta-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
    }
    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.8rem;
    }
    .field label {
      font-weight: 500;
      color: #475467;
    }
    .field input,
    .field select {
      border-radius: 8px;
      border: 1px solid #d0d5dd;
      padding: 6px 8px;
      font-size: 0.84rem;
      font-family: inherit;
    }
    .field input:focus,
    .field select:focus {
      outline: none;
      border-color: #f97316;
      box-shadow: 0 0 0 1px #fed7aa;
      background: #fff;
    }
    .export-output {
      margin-top: 10px;
      font-size: 0.78rem;
    }
    .export-output textarea {
      min-height: 140px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .badge-low {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: #fee2e2;
      color: #b91c1c;
    }

    .hidden {
      display: none !important;
    }

    @media (max-width: 640px) {
      header {
        padding: 16px 12px 10px;
      }
      .title {
        font-size: 1.1rem;
      }
      main {
        padding: 0 12px 32px;
      }
    }
  </style>
</head>
<body>
<header>
  <div class="header-inner">
    <div>
      <div class="title">DIAG4U+ ‚Äì Life Skills & Parcours</div>
      <div class="subtitle">Du diagnostic aux actions concr√®tes, en 5 √©tapes.</div>
    </div>
    <div class="step-flow" aria-label="Sch√©ma du parcours">
      <span class="chip chip-primary"><span class="icon">üß†</span> Diagnostic</span>
      <span>‚Üí</span>
      <span class="chip"><span class="icon">üéØ</span> 1‚Äì3 priorit√©s</span>
      <span>‚Üí</span>
      <span class="chip"><span class="icon">üöá</span> Mini-parcours</span>
      <span>‚Üí</span>
      <span class="chip"><span class="icon">üìù</span> Plan d‚Äôaction</span>
      <span>‚Üí</span>
      <span class="chip"><span class="icon">üì§</span> Export FT / RPE</span>
    </div>
  </div>
</header>

<main>
  <!-- 1. Visualisation rapide des r√©sultats -->
  <section id="section-results">
    <h2 class="section-title"><span class="icon">üìä</span>1. R√©sultats de mon diagnostic</h2>
    <p class="section-desc">
      Ces scores sont issus du diagnostic Life Skills (11 domaines). Ils peuvent √™tre r√©cup√©r√©s automatiquement depuis la version existante de DIAG4U.
    </p>
    <div class="card">
      <div class="results-grid" id="results-grid"></div>
    </div>
  </section>

  <!-- 2. Choix des priorit√©s -->
  <section id="section-priorities">
    <h2 class="section-title"><span class="icon">üéØ</span>2. Je choisis mes 1‚Äì3 priorit√©s</h2>
    <p class="section-desc">
      S√©lectionne jusqu‚Äô√† <strong>3 domaines</strong> que tu veux travailler en premier. Les domaines les plus fragiles sont surlign√©s.
    </p>
    <div class="card">
      <div class="priority-grid" id="priority-grid"></div>
      <div class="counter-line">
        <div><strong id="selected-count">0</strong> priorit√©(s) choisie(s) sur 3</div>
        <button id="btn-validate-priorities" class="btn-primary btn-small" disabled>
          Continuer vers les mini-parcours
        </button>
      </div>
    </div>
  </section>

  <!-- 3. Mini-parcours propos√©s -->
  <section id="section-minip" class="hidden">
    <h2 class="section-title"><span class="icon">üöá</span>3. Mini-parcours propos√©s</h2>
    <p class="section-desc">
      Pour chaque priorit√©, nous te proposons un <strong>mini-parcours th√©matique</strong> avec des outils LS4YOU adapt√©s.
      Tu peux ajouter ceux que tu veux dans ton plan d‚Äôaction.
    </p>
    <div class="card">
      <div class="minip-grid" id="minip-grid"></div>
    </div>
  </section>

  <!-- 4. Plan d'action pr√©-rempli -->
  <section id="section-plan" class="hidden">
    <h2 class="section-title"><span class="icon">üìù</span>4. Mon plan d‚Äôaction (pr√©-rempli)</h2>
    <p class="section-desc">
      Les actions ci-dessous sont propos√©es automatiquement √† partir des mini-parcours. Tu peux les modifier, les simplifier ou en ajouter d‚Äôautres.
    </p>
    <div class="card">
      <div class="plan-grid">
        <div class="plan-block">
          <div class="plan-label">Ce que j‚Äôai compris sur moi</div>
          <textarea id="field-understanding" placeholder="Exemple : Je vois que je suis plut√¥t √† l‚Äôaise sur X mais j‚Äôai besoin de travailler Y et Z."></textarea>
        </div>
        <div class="plan-block">
          <div class="plan-label">Ce que je veux changer / am√©liorer</div>
          <textarea id="field-goals" placeholder="Exemple : Je veux clarifier mon projet pro et s√©curiser mon budget et mon logement."></textarea>
        </div>
        <div class="plan-block">
          <div class="plan-label">Ce que je vais faire dans les 30 jours</div>
          <textarea id="field-actions" placeholder="Les actions propos√©es √† partir des mini-parcours appara√Ætront ici."></textarea>
        </div>
        <div class="plan-block">
          <div class="plan-label">De quoi j‚Äôai besoin pour y arriver</div>
          <textarea id="field-needs" placeholder="Exemple : aide pour mon CV, coordonn√©es d‚Äôun travailleur social, accompagnement pour g√©rer mon stress."></textarea>
        </div>
      </div>
    </div>
  </section>

  <!-- 5. M√©tadonn√©es & export institutionnel -->
  <section id="section-export" class="hidden">
    <h2 class="section-title"><span class="icon">üì§</span>5. Export France Travail / RPE</h2>
    <p class="section-desc">
      Ces informations serviront √† alimenter le diagnostic partag√© et les tableaux de bord (CSV / JSON). Aucun stockage n‚Äôest fait ici : tout reste c√¥t√© navigateur.
    </p>
    <div class="card">
      <div class="meta-grid">
        <div class="field">
          <label for="meta-structure">Structure / organisme</label>
          <input id="meta-structure" type="text" placeholder="Mission Locale Pays Basque‚Ä¶">
        </div>
        <div class="field">
          <label for="meta-conseiller">Conseiller / r√©f√©rent</label>
          <input id="meta-conseiller" type="text" placeholder="Nom du conseiller‚Ä¶">
        </div>
        <div class="field">
          <label for="meta-dispositif">Dispositif</label>
          <select id="meta-dispositif">
            <option value="">S√©lectionner‚Ä¶</option>
            <option>CEJ</option>
            <option>PACEA</option>
            <option>Autre / Partenaire</option>
          </select>
        </div>
        <div class="field">
          <label for="meta-modalite">Modalit√© d‚Äôaccompagnement estim√©e</label>
          <select id="meta-modalite">
            <option value="">S√©lectionner‚Ä¶</option>
            <option>Autonomie</option>
            <option>Individuel</option>
            <option>Collectif</option>
            <option>Partenaire externe</option>
          </select>
        </div>
        <div class="field">
          <label for="meta-engagement">Niveau d‚Äôengagement du jeune</label>
          <select id="meta-engagement">
            <option value="">S√©lectionner‚Ä¶</option>
            <option>Pr√™t</option>
            <option>H√©sitant</option>
            <option>D√©motiv√©</option>
            <option>√Ä remotiver</option>
          </select>
        </div>
        <div class="field">
          <label for="meta-date">Date du diagnostic</label>
          <input id="meta-date" type="date">
        </div>
      </div>

      <div style="margin-top: 14px; display:flex; flex-wrap:wrap; gap:8px; align-items:center;">
        <button id="btn-export-json" class="btn-secondary btn-small">G√©n√©rer JSON</button>
        <button id="btn-export-csv" class="btn-secondary btn-small">G√©n√©rer CSV</button>
        <span style="font-size:0.75rem; color:#9ca3af;">(copier/coller dans votre SI ou l‚Äôoutil RPE)</span>
      </div>

      <div class="export-output">
        <div class="plan-label" style="margin-top:10px;">Aper√ßu export</div>
        <textarea id="export-output" placeholder="Le JSON ou CSV g√©n√©r√© appara√Ætra ici."></textarea>
      </div>
    </div>
  </section>
</main>

<script>
  // ---------------------------
  // 1. Donn√©es de base simul√©es
  // ‚Üí √Ä remplacer par les vraies donn√©es DIAG4U (API, localStorage, etc.)
  // ---------------------------

  const domains = [
    { id: "emploi",       name: "Emploi",              score: 3 },
    { id: "formation",    name: "Formation",           score: 4 },
    { id: "sante",        name: "Sant√© / Bien-√™tre",   score: 2 },
    { id: "budget",       name: "Budget / Finances",   score: 2 },
    { id: "logement",     name: "Logement",            score: 1 },
    { id: "mobilite",     name: "Mobilit√©",            score: 5 },
    { id: "relations",    name: "Relations / R√©seau",  score: 4 },
    { id: "temps",        name: "Organisation / Temps",score: 3 },
    { id: "numerique",    name: "Comp√©tences num√©riques", score: 4 },
    { id: "engagement",   name: "Engagement / Loisirs",score: 3 },
    { id: "confiance",    name: "Estime de soi / Confiance", score: 2 }
  ];

  // Mapping domaine ‚Üí mini-parcours LS4YOU
  const miniParcoursConfig = {
    emploi: {
      theme: "Emploi",
      icon: "üíº",
      objectif: "Clarifier ton projet pro et pr√©parer ta recherche d‚Äôemploi.",
      outils: ["Moi √† mon meilleur ‚Äì Pitch perso", "Mon image professionnelle", "Simulation d‚Äôentretien"],
      actions: [
        "Mettre √† jour ton CV avec le conseiller avant la fin du mois.",
        "Identifier 3 offres d‚Äôemploi r√©alistes et y candidater.",
        "Pr√©parer un pitch de 2 minutes pour te pr√©senter en entretien."
      ]
    },
    formation: {
      theme: "Formation",
      icon: "üéì",
      objectif: "Identifier des formations r√©alistes et motivantes.",
      outils: ["Mon Magazine Perso", "Carte des formations", "Budget formation"],
      actions: [
        "Lister 2‚Äì3 pistes de formation qui t‚Äôint√©ressent.",
        "Prendre contact avec au moins 1 organisme de formation.",
        "V√©rifier les pr√©requis (niveau, financement, mobilit√©)."
      ]
    },
    sante: {
      theme: "Sant√© / Bien-√™tre",
      icon: "üß†",
      objectif: "Mieux g√©rer ton stress et ton √©quilibre de vie.",
      outils: ["Stressom√®tre", "Mon mode de vie ‚Äì Bilan & actions", "Mon r√©seau de soutien"],
      actions: [
        "Rep√©rer 3 situations qui te stressent le plus et les noter.",
        "Mettre en place une petite routine bien-√™tre (sommeil, sport, temps calme).",
        "Identifier une personne ou un pro avec qui parler si √ßa ne va pas."
      ]
    },
    budget: {
      theme: "Budget / Finances",
      icon: "üí∂",
      objectif: "Reprendre la main sur ton budget au quotidien.",
      outils: ["Budget simple", "Mes priorit√©s de d√©penses", "Plan √©pargne mini"],
      actions: [
        "Lister toutes tes entr√©es et sorties d‚Äôargent sur un mois.",
        "Rep√©rer 2‚Äì3 d√©penses que tu peux r√©duire sans te mettre en difficult√©.",
        "Fixer un petit objectif d‚Äô√©pargne (m√™me symbolique)."
      ]
    },
    logement: {
      theme: "Logement",
      icon: "üè†",
      objectif: "Avancer vers une solution de logement plus stable.",
      outils: ["Mes crit√®res logement", "Carte des dispositifs locaux", "Dossier locataire"],
      actions: [
        "Clarifier ce que tu cherches (lieu, budget, contraintes).",
        "Identifier 2‚Äì3 dispositifs ou contacts logement sur ton territoire.",
        "Constituer un d√©but de dossier (papiers d‚Äôidentit√©, ressources, etc.)."
      ]
    },
    mobilite: {
      theme: "Mobilit√©",
      icon: "üöå",
      objectif: "Faciliter tes d√©placements pour le travail, la formation ou la vie quotidienne.",
      outils: ["Je me d√©place ‚Äì Parcours mobilit√©", "Budget transport", "Solutions alternatives (covoiturage, v√©lo, etc.)"],
      actions: [
        "Rep√©rer comment tu te rends sur 1‚Äì2 lieux importants (ML, formation, travail).",
        "Comparer plusieurs solutions de transport (temps, co√ªt).",
        "Pr√©voir un plan B en cas de probl√®me (retard, annulation)."
      ]
    },
    relations: {
      theme: "Relations / R√©seau",
      icon: "ü§ù",
      objectif: "Activer les bonnes personnes autour de toi.",
      outils: ["Mon r√©seau de soutien", "Carte de mon r√©seau pro/perso", "Qui peut m‚Äôaider pour quoi ?"],
      actions: [
        "Identifier 3 personnes ressources dans ton entourage.",
        "Rep√©rer 1 personne √† qui demander un coup de main cette semaine.",
        "Lister les lieux o√π tu peux rencontrer de nouveaux contacts (asso, forums‚Ä¶)."
      ]
    },
    temps: {
      theme: "Organisation / Temps",
      icon: "‚è±Ô∏è",
      objectif: "Mieux organiser ton temps pour avancer sur tes projets.",
      outils: ["Mon planning simple", "Prioriser mes t√¢ches", "Temps perso / temps pro"],
      actions: [
        "Construire un planning simple sur 7 jours avec tes rendez-vous et obligations.",
        "Choisir 3 actions prioritaires pour la semaine et les placer dans ton planning.",
        "R√©server un cr√©neau pour toi (repos, activit√© qui te fait du bien)."
      ]
    },
    numerique: {
      theme: "Comp√©tences num√©riques",
      icon: "üì±",
      objectif: "Utiliser le num√©rique pour ton projet plut√¥t que le subir.",
      outils: ["Diagnostic num√©rique simple", "Cr√©er une adresse mail pro", "Identit√© num√©rique"],
      actions: [
        "V√©rifier que tu as une adresse mail fonctionnelle et professionnelle.",
        "Cr√©er ou mettre √† jour un espace de stockage (cloud) pour tes documents importants.",
        "Identifier si tu as besoin d‚Äôun coup de main pour certains outils (Word, CV en ligne, etc.)."
      ]
    },
    engagement: {
      theme: "Engagement / Loisirs",
      icon: "üé®",
      objectif: "Retrouver du plaisir et du sens par une activit√© r√©guli√®re.",
      outils: ["Mes passions", "Carte des assos / lieux de loisirs", "Challenge 30 jours"],
      actions: [
        "Lister 3 activit√©s qui te plaisent ou t‚Äôont plu dans le pass√©.",
        "Rep√©rer 1 lieu ou association √† contacter pour essayer une activit√©.",
        "Te fixer un petit d√©fi sur 30 jours (une activit√© r√©guli√®re, m√™me courte)."
      ]
    },
    confiance: {
      theme: "Estime de soi / Confiance",
      icon: "üå±",
      objectif: "Identifier tes forces et te sentir plus l√©gitime.",
      outils: ["Moi √† mon meilleur", "Feedback positif", "Journal de r√©ussites"],
      actions: [
        "√âcrire 3 choses dont tu es fier (m√™me petites).",
        "Demander √† 1‚Äì2 personnes de ton entourage ce qu‚Äôelles appr√©cient chez toi.",
        "Noter chaque semaine une r√©ussite ou un progr√®s, m√™me minime."
      ]
    }
  };

  // √âtat
  let selectedDomainIds = [];

  // ---------------------------
  // Rendu des r√©sultats
  // ---------------------------
  function renderResults() {
    const container = document.getElementById("results-grid");
    container.innerHTML = "";

    domains.forEach(d => {
      const pill = document.createElement("div");
      pill.className = "domain-pill";

      const header = document.createElement("div");
      header.className = "domain-header";

      const name = document.createElement("div");
      name.className = "domain-name";
      name.textContent = d.name;

      const score = document.createElement("div");
      score.className = "domain-score";
      score.textContent = `Score : ${d.score}/10`;

      header.appendChild(name);
      header.appendChild(score);

      const bar = document.createElement("div");
      bar.className = "score-bar";
      const fill = document.createElement("div");
      fill.className = "score-bar-fill";
      fill.style.width = `${Math.max(0, Math.min(10, d.score)) * 10}%`;
      bar.appendChild(fill);

      const tag = document.createElement("div");
      tag.className = "score-tag";
      if (d.score <= 3) {
        tag.innerHTML = '<span class="badge-low">Domaine fragile</span>';
      } else if (d.score >= 7) {
        tag.textContent = "Force √† valoriser";
      } else {
        tag.textContent = "√Ä suivre";
      }

      pill.appendChild(header);
      pill.appendChild(bar);
      pill.appendChild(tag);
      container.appendChild(pill);
    });
  }

  // ---------------------------
  // Rendu s√©lection priorit√©s
  // ---------------------------
  function renderPriorities() {
    const grid = document.getElementById("priority-grid");
    grid.innerHTML = "";

    domains.forEach(d => {
      const card = document.createElement("div");
      card.className = "priority-card";
      if (d.score <= 3) card.classList.add("low");
      card.dataset.id = d.id;

      const title = document.createElement("div");
      title.className = "priority-title";
      title.textContent = d.name;

      const score = document.createElement("div");
      score.className = "priority-score";
      score.textContent = `Score : ${d.score}/10`;

      const hint = document.createElement("div");
      hint.className = "priority-hint";
      hint.textContent = "Cliquer pour (d√©)s√©lectionner";

      const badge = document.createElement("div");
      badge.className = "selection-badge";
      badge.textContent = "Choisi";

      card.appendChild(title);
      card.appendChild(score);
      card.appendChild(hint);
      card.appendChild(badge);

      card.addEventListener("click", () => togglePriority(d.id, card));
      grid.appendChild(card);
    });

    updatePriorityCounter();
  }

  function togglePriority(id, cardElement) {
    const index = selectedDomainIds.indexOf(id);
    if (index >= 0) {
      selectedDomainIds.splice(index, 1);
      cardElement.classList.remove("selected");
    } else {
      if (selectedDomainIds.length >= 3) return; // max 3
      selectedDomainIds.push(id);
      cardElement.classList.add("selected");
    }
    updatePriorityCounter();
  }

  function updatePriorityCounter() {
    const countEl = document.getElementById("selected-count");
    const btn = document.getElementById("btn-validate-priorities");
    countEl.textContent = selectedDomainIds.length.toString();
    btn.disabled = selectedDomainIds.length === 0;
  }

  // ---------------------------
  // Mini-parcours
  // ---------------------------
  function renderMiniParcours() {
    const section = document.getElementById("section-minip");
    const grid = document.getElementById("minip-grid");
    grid.innerHTML = "";

    selectedDomainIds.forEach(id => {
      const domain = domains.find(d => d.id === id);
      const config = miniParcoursConfig[id];
      if (!domain || !config) return;

      const card = document.createElement("div");
      card.className = "minip-card";

      const header = document.createElement("div");
      header.className = "minip-header";

      const title = document.createElement("div");
      title.className = "minip-title";
      title.textContent = `${config.icon || "üöá"} ${config.theme}`;

      const chip = document.createElement("div");
      chip.className = "minip-chip";
      chip.textContent = `Priorit√© : ${domain.name}`;

      header.appendChild(title);
      header.appendChild(chip);

      const body = document.createElement("div");
      body.className = "minip-body";
      body.textContent = config.objectif;

      const tools = document.createElement("div");
      tools.className = "minip-tools";
      tools.textContent = `Outils LS4YOU : ${config.outils.join(" ‚Ä¢ ")}`;

      const btn = document.createElement("button");
      btn.className = "btn-primary btn-small";
      btn.textContent = "Ajouter au plan d‚Äôaction";
      btn.addEventListener("click", () => addToActionPlan(id));

      card.appendChild(header);
      card.appendChild(body);
      card.appendChild(tools);
      card.appendChild(btn);
      grid.appendChild(card);
    });

    section.classList.remove("hidden");
  }

  function addToActionPlan(domainId) {
    const config = miniParcoursConfig[domainId];
    if (!config) return;

    const actionsField = document.getElementById("field-actions");
    const current = actionsField.value.trim();
    const header = `‚Ä¢ ${config.theme} (${config.objectif})`;
    const actionsText = config.actions.map(a => `   - ${a}`).join("\n");

    const block = `${header}\n${actionsText}\n`;
    actionsField.value = current ? current + "\n" + block : block;

    // Affiche sections plan + export au besoin
    document.getElementById("section-plan").classList.remove("hidden");
    document.getElementById("section-export").classList.remove("hidden");
  }

  // ---------------------------
  // Export JSON / CSV
  // ---------------------------
  function collectExportData() {
    const selectedDomains = selectedDomainIds.map(id => {
      const d = domains.find(dom => dom.id === id);
      return d ? { id: d.id, name: d.name, score: d.score } : null;
    }).filter(Boolean);

    const meta = {
      structure: document.getElementById("meta-structure").value.trim(),
      conseiller: document.getElementById("meta-conseiller").value.trim(),
      dispositif: document.getElementById("meta-dispositif").value,
      modalite: document.getElementById("meta-modalite").value,
      engagement: document.getElementById("meta-engagement").value,
      date: document.getElementById("meta-date").value
    };

    const plan = {
      understanding: document.getElementById("field-understanding").value.trim(),
      goals: document.getElementById("field-goals").value.trim(),
      actions: document.getElementById("field-actions").value.trim(),
      needs: document.getElementById("field-needs").value.trim()
    };

    return {
      meta,
      selectedDomains,
      plan
    };
  }

  function exportJSON() {
    const data = collectExportData();
    const out = document.getElementById("export-output");
    out.value = JSON.stringify(data, null, 2);
  }

  function exportCSV() {
    const data = collectExportData();
    const rows = [];
    // Ligne d'ent√™te simple
    rows.push([
      "structure",
      "conseiller",
      "dispositif",
      "modalite",
      "engagement",
      "date",
      "domaines_prioritaires",
      "plan_actions"
    ].join(";"));

    const domaines = data.selectedDomains
      .map(d => `${d.name} (${d.score}/10)`)
      .join(" | ");

    const actions = data.plan.actions.replace(/\n/g, " / ");

    rows.push([
      data.meta.structure || "",
      data.meta.conseiller || "",
      data.meta.dispositif || "",
      data.meta.modalite || "",
      data.meta.engagement || "",
      data.meta.date || "",
      domaines,
      actions
    ].map(value => `"${(value || "").replace(/"/g, '""')}"`).join(";"));

    const csv = rows.join("\n");
    document.getElementById("export-output").value = csv;
  }

  // ---------------------------
  // Init
  // ---------------------------
  document.addEventListener("DOMContentLoaded", () => {
    renderResults();
    renderPriorities();

    document.getElementById("btn-validate-priorities").addEventListener("click", () => {
      renderMiniParcours();
      document.getElementById("section-plan").classList.remove("hidden");
      document.getElementById("section-export").classList.remove("hidden");

      // Scroll doux vers la suite
      document.getElementById("section-minip").scrollIntoView({ behavior: "smooth" });
    });

    document.getElementById("btn-export-json").addEventListener("click", exportJSON);
    document.getElementById("btn-export-csv").addEventListener("click", exportCSV);
  });
</script>
</body>
</html>
